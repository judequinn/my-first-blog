{% extends 'blog/base_menu.html' %}
{% load staticfiles %}
{% block content %}

<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script> <!-- Yandex Map -->
<script src="{% static 'js/jquery-1.11.3.min.js' %}"></script> <!-- jQuery Core -->

<!-- Map Menu JS -->
<script>
$(document).ready(function() {
    $(".review-list").hide();
    $(".section").click(function() {
        $(this).parent().find(".review-list").slideToggle('fast');
    });
    });
</script>

<!-- Map JS -->
<script type="text/javascript">

    ymaps.ready(init);

    function init(){ 

        ymaps.load(['package.GeoObjectCollection']);

        var myMap, myPlacemark, 
        myCafes = new ymaps.GeoObjectCollection(),
        myShops = new ymaps.GeoObjectCollection(),
        myMuseums = new ymaps.GeoObjectCollection();

        myMap = new ymaps.Map("map", {
            center: [55.76, 37.64],
            zoom: 11,
            controls: ['smallMapDefaultSet'],}, 
            {
            searchControlProvider: 'yandex#search'
        });

        {% for review in reviews %}
        {% if review.c_latitude %}
        {% if review.tag == 'shops' %} 

        myPlacemark = new ymaps.Placemark([{{ review.c_latitude }}, {{ review.c_longitude }}], { 
            hintContent: '{{ review.title }}', 
            balloonContent: '{{ review.text|safe }}' 
        },
        { preset: 'islands#orangeDotIcon' 
        });

        myShops.add(myPlacemark);

        {% elif review.tag == 'cafes' %}
        myPlacemark = new ymaps.Placemark([{{ review.c_latitude }}, {{ review.c_longitude }}], { 
            hintContent: '{{ review.title }}', 
            balloonContent: '{{ review.text|safe }}' 
        },
        { preset: 'islands#blueDotIcon' 
        });
        myCafes.add(myPlacemark);

        {% elif review.tag == 'museums' %}
        myPlacemark = new ymaps.Placemark([{{ review.c_latitude }}, {{ review.c_longitude }}], { 
            hintContent: '{{ review.title }}', 
            balloonContent: '{{ review.text|safe }}' 
        },
        { preset: 'islands#redDotIcon' 
        });
        myMuseums.add(myPlacemark);
        
        {% endif %}
        {% endif %}
        {% endfor %} 

        myMap.geoObjects.add(myShops);
        myMap.geoObjects.add(myMuseums); 
        myMap.geoObjects.add(myCafes);

        $('#cafes').click(function(event){

        myMap.geoObjects.add(myCafes);

        }); 
    };  
</script>
<!-- End Map JS -->

<div class="page">
    <div id="map-container" class="container"> <!-- Map container -->
        <div id="map"> <!-- Map rendering here --> </div>
        <div id="map-menu"> <!-- Map menu -->
            <div> <!-- Cafes -->
                <h3 class="section" id="cafes"><a>Кафе</a></h3>
                <ul class="review-list">
                    {% for review in reviews %}
                    {% if review.c_latitude %}
                    {% if review.tag == "cafes" %}
                    <li><a href="#">{{ review.title }} ({{ review.address }})</a></li>
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                </ul>
            </div> <!-- Cafes -->
            <div> <!-- Shops -->
                <h3 class="section" id="shops"><a>Магазины</a></h3>
                <ul class="review-list">
                    {% for review in reviews %}
                    {% if review.c_latitude %}
                    {% if review.tag == "shops" %}
                    <li><a href="#">{{ review.title }} ({{ review.address }})</a></li>
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                </ul>
            </div> <!-- Shops -->
            <div> <!-- Museums -->
                <h3 class="section" id="museums"><a>Музеи</a></h3>
                <ul class="review-list">
                    {% for review in reviews %}
                    {% if review.c_latitude %}
                    {% if review.tag == "museums" %}
                    <li><a href="#">{{ review.title }} ({{ review.address }})</a></li>
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                </ul>
            </div> <!-- Museums -->
        </div> <!-- Map menu -->
    </div> <!-- Map container -->
</div>

{% endblock %}